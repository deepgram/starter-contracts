asyncapi: 3.0.0
info:
  title: Agent Interface Contract
  version: 1.0.0
  description: |
    Minimal Voice Agent scaffolding for Deepgram starter applications.
    Connect to a conversational AI agent via WebSocket with speech-to-text, LLM processing, and text-to-speech capabilities.
  contact:
    email: devrel@deepgram.com
    url: https://community.deepgram.com
    name: Deepgram Developer Relations
  license:
    name: Privacy Notice
    url: https://deepgram.com/privacy/
  externalDocs:
    description: Visit our docs to learn more about using Deepgram APIs
    url: https://developers.deepgram.com
servers:
  starter-app:
    host: "{host}:{port}"
    protocol: wss
    description: Starter app development server
    security:
      - $ref: "#/components/securitySchemes/ApiKeyAuth"
components:
  securitySchemes:
    ApiKeyAuth:
      type: httpApiKey
      in: header
      name: Authorization
      description: API key authentication (handled by starter app proxy)
  operationTraits:
    AuthTrait:
      security:
        - $ref: "#/components/securitySchemes/ApiKeyAuth"
  schemas:
    SettingsMessage:
      type: object
      description: Initial settings configuration for the Voice Agent
      required:
        - type
        - audio
        - agent
      properties:
        type:
          type: string
          const: Settings
          description: Message type identifier
        audio:
          type: object
          description: Audio input and output configuration
          required:
            - input
            - output
          properties:
            input:
              type: object
              description: Audio input configuration
              required:
                - encoding
                - sample_rate
              properties:
                encoding:
                  type: string
                  default: linear16
                  enum:
                    - linear16
                    - linear32
                    - mulaw
                  description: Audio encoding format
                sample_rate:
                  type: number
                  default: 24000
                  description: Sample rate in Hz (e.g., 16000, 24000, 48000)
            output:
              type: object
              description: Audio output configuration
              required:
                - encoding
                - sample_rate
              properties:
                encoding:
                  type: string
                  default: linear16
                  enum:
                    - linear16
                    - mulaw
                  description: Audio encoding format for output
                sample_rate:
                  type: number
                  default: 24000
                  description: Sample rate in Hz
                container:
                  type: string
                  default: none
                  description: Audio container format
        agent:
          type: object
          description: Agent configuration for listen, think, and speak
          required:
            - listen
            - think
            - speak
          properties:
            listen:
              type: object
              description: Speech-to-text configuration
              required:
                - provider
              properties:
                provider:
                  type: object
                  required:
                    - type
                    - model
                  properties:
                    type:
                      type: string
                      enum:
                        - deepgram
                      description: STT provider type
                    model:
                      type: string
                      default: nova-3
                      description: STT model identifier
                      examples:
                        - nova-3
                        - nova-2
            think:
              type: object
              description: LLM configuration
              required:
                - provider
              properties:
                provider:
                  type: object
                  required:
                    - type
                    - model
                  properties:
                    type:
                      type: string
                      enum:
                        - open_ai
                        - anthropic
                        - google
                      description: LLM provider type
                    model:
                      type: string
                      description: LLM model identifier
                      examples:
                        - gpt-4o-mini
                        - claude-3-5-haiku-latest
                        - gemini-2.0-flash
            speak:
              type: object
              description: Text-to-speech configuration
              required:
                - provider
              properties:
                provider:
                  type: object
                  required:
                    - type
                    - model
                  properties:
                    type:
                      type: string
                      enum:
                        - deepgram
                      description: TTS provider type
                    model:
                      type: string
                      default: aura-2-thalia-en
                      description: Deepgram TTS model identifier
                      examples:
                        - aura-2-thalia-en
                        - aura-asteria-en
    WelcomeMessage:
      type: object
      description: Connection confirmation message
      required:
        - type
        - request_id
      properties:
        type:
          type: string
          const: Welcome
          description: Message type identifier
        request_id:
          type: string
          format: uuid
          description: Unique request identifier
    SettingsAppliedEvent:
      type: object
      description: Confirmation that settings were applied
      required:
        - type
      properties:
        type:
          type: string
          const: SettingsApplied
          description: Message type identifier
    ConversationTextEvent:
      type: object
      description: Conversation text from user or assistant
      required:
        - type
        - role
        - content
      properties:
        type:
          type: string
          const: ConversationText
          description: Message type identifier
        role:
          type: string
          enum:
            - user
            - assistant
          description: Speaker role
        content:
          type: string
          description: Spoken text content
    UserStartedSpeakingEvent:
      type: object
      description: Notification that user began speaking
      required:
        - type
      properties:
        type:
          type: string
          const: UserStartedSpeaking
          description: Message type identifier
    AgentThinkingEvent:
      type: object
      description: Notification that agent is processing
      required:
        - type
        - content
      properties:
        type:
          type: string
          const: AgentThinking
          description: Message type identifier
        content:
          type: string
          description: Agent's thought process
    AgentAudioDoneEvent:
      type: object
      description: Notification that agent finished sending audio
      required:
        - type
      properties:
        type:
          type: string
          const: AgentAudioDone
          description: Message type identifier
    ErrorEvent:
      type: object
      description: Error event
      required:
        - type
        - description
        - code
      properties:
        type:
          type: string
          enum:
            - Error
          description: Message type identifier
        description:
          type: string
          description: Human-readable error description
        code:
          type: string
          enum:
            - INVALID_SETTINGS
            - MISSING_API_KEY
            - AUDIO_FORMAT_ERROR
            - CONNECTION_FAILED
            - PROVIDER_ERROR
          description: Machine-readable error code
    WarningEvent:
      type: object
      description: Warning event for non-fatal issues
      required:
        - type
        - description
        - code
      properties:
        type:
          type: string
          enum:
            - Warning
          description: Message type identifier
        description:
          type: string
          description: Human-readable warning description
        code:
          type: string
          description: Machine-readable warning code
    AudioData:
      type: string
      format: binary
      description: Binary audio data for agent processing
      contentType: application/octet-stream
    AudioChunk:
      type: string
      format: binary
      description: Binary audio output from agent
      contentType: application/octet-stream
  messages:
    SettingsMessage:
      name: SettingsMessage
      title: Settings
      description: Initial configuration for the Voice Agent
      contentType: application/json
      payload:
        $ref: "#/components/schemas/SettingsMessage"
    AudioDataMessage:
      name: AudioDataMessage
      title: Audio Input
      description: Audio data sent to the agent
      contentType: application/octet-stream
      payload:
        $ref: "#/components/schemas/AudioData"
    WelcomeMessage:
      name: WelcomeMessage
      title: Welcome
      description: Connection confirmation
      contentType: application/json
      payload:
        $ref: "#/components/schemas/WelcomeMessage"
    SettingsAppliedEventMessage:
      name: SettingsAppliedEventMessage
      title: Settings Applied
      description: Settings confirmation
      contentType: application/json
      payload:
        $ref: "#/components/schemas/SettingsAppliedEvent"
    ConversationTextEventMessage:
      name: ConversationTextEventMessage
      title: Conversation Text
      description: Text from conversation
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ConversationTextEvent"
    UserStartedSpeakingEventMessage:
      name: UserStartedSpeakingEventMessage
      title: User Started Speaking
      description: User speech detection
      contentType: application/json
      payload:
        $ref: "#/components/schemas/UserStartedSpeakingEvent"
    AgentThinkingEventMessage:
      name: AgentThinkingEventMessage
      title: Agent Thinking
      description: Agent processing notification
      contentType: application/json
      payload:
        $ref: "#/components/schemas/AgentThinkingEvent"
    AgentAudioDoneEventMessage:
      name: AgentAudioDoneEventMessage
      title: Agent Audio Done
      description: Agent audio completion
      contentType: application/json
      payload:
        $ref: "#/components/schemas/AgentAudioDoneEvent"
    AudioChunkMessage:
      name: AudioChunkMessage
      title: Audio Output
      description: Audio response from agent
      contentType: application/octet-stream
      payload:
        $ref: "#/components/schemas/AudioChunk"
    ErrorEventMessage:
      name: ErrorEventMessage
      title: Error
      description: Error information
      contentType: application/json
      payload:
        $ref: "#/components/schemas/ErrorEvent"
    WarningEventMessage:
      name: WarningEventMessage
      title: Warning
      description: Warning information
      contentType: application/json
      payload:
        $ref: "#/components/schemas/WarningEvent"
channels:
  AgentConverse:
    address: /agent/converse
    description: Voice Agent conversation via WebSocket
    messages:
      Settings:
        $ref: "#/components/messages/SettingsMessage"
      AudioData:
        $ref: "#/components/messages/AudioDataMessage"
      Welcome:
        $ref: "#/components/messages/WelcomeMessage"
      SettingsApplied:
        $ref: "#/components/messages/SettingsAppliedEventMessage"
      ConversationText:
        $ref: "#/components/messages/ConversationTextEventMessage"
      UserStartedSpeaking:
        $ref: "#/components/messages/UserStartedSpeakingEventMessage"
      AgentThinking:
        $ref: "#/components/messages/AgentThinkingEventMessage"
      AgentAudioDone:
        $ref: "#/components/messages/AgentAudioDoneEventMessage"
      AudioChunk:
        $ref: "#/components/messages/AudioChunkMessage"
      ErrorEvent:
        $ref: "#/components/messages/ErrorEventMessage"
      WarningEvent:
        $ref: "#/components/messages/WarningEventMessage"
operations:
  SendSettings:
    action: send
    channel:
      $ref: "#/channels/AgentConverse"
    description: Send initial settings configuration
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/Settings"
  SendAudioData:
    action: send
    channel:
      $ref: "#/channels/AgentConverse"
    description: Send audio data to the agent
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/AudioData"
  ReceiveWelcome:
    action: receive
    channel:
      $ref: "#/channels/AgentConverse"
    description: Receive connection confirmation
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/Welcome"
  ReceiveSettingsApplied:
    action: receive
    channel:
      $ref: "#/channels/AgentConverse"
    description: Receive settings confirmation
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/SettingsApplied"
  ReceiveConversationText:
    action: receive
    channel:
      $ref: "#/channels/AgentConverse"
    description: Receive conversation text events
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/ConversationText"
  ReceiveUserStartedSpeaking:
    action: receive
    channel:
      $ref: "#/channels/AgentConverse"
    description: Receive user speech detection
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/UserStartedSpeaking"
  ReceiveAgentThinking:
    action: receive
    channel:
      $ref: "#/channels/AgentConverse"
    description: Receive agent processing notifications
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/AgentThinking"
  ReceiveAgentAudioDone:
    action: receive
    channel:
      $ref: "#/channels/AgentConverse"
    description: Receive agent audio completion
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/AgentAudioDone"
  ReceiveAudioChunk:
    action: receive
    channel:
      $ref: "#/channels/AgentConverse"
    description: Receive audio output from agent
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/AudioChunk"
  ReceiveError:
    action: receive
    channel:
      $ref: "#/channels/AgentConverse"
    description: Receive error events
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/ErrorEvent"
  ReceiveWarning:
    action: receive
    channel:
      $ref: "#/channels/AgentConverse"
    description: Receive warning events
    traits:
      - $ref: "#/components/operationTraits/AuthTrait"
    messages:
      - $ref: "#/channels/AgentConverse/messages/WarningEvent"
